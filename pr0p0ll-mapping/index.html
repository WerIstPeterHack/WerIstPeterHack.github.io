<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>

<body>
	<script>

	window.addEventListener('load', function(){

		function submit(event){
			if(event.which === 13){
				process();
				event.preventDefault(); 
			}
		}

		document.getElementById('jsonData').addEventListener('keypress', submit);
		document.getElementById('jsonData').focus();

		function process() {

			var results = JSON.parse(document.getElementById('jsonData').value);
			var mappings = [];
			var answerKey = new RegExp('a\\d+'); // to identify answer properties

			for (let key in results){
				
				if(results.hasOwnProperty(key)){
						
					// let's parse a question
					if (key != 'info') {

						// first add this question's id to header as a new column
						// this makes it easier for you to do cross-references when 
						// analysing the data 
						// (e.g. how many people answered a1 in q1 also answered a2 in q3)

						var answers = results[key];
						
						var mapping = [];
											
						for (let answer in answers) {

							if(answers.hasOwnProperty(answer)){

								// if this property matches you regex (starts with an a, ends with a number), it contains answer details
								if (answerKey.test(answer)) {

									mapping['0_answerId'] = answers[answer].id;
									mapping['1_question'] = results[key].title;
									mapping['2_answer'] = answers[answer].title;
									mappings.push(mapping);
									mapping = [];

								}


							}

						}
					}
				
				}
			}


			var output = ''

			for (var i = 0; i < mappings.length; i++) {
			
				var line = '\r\n';


				for (var index in mappings[i]) {

					// header
					if (i == 0) {

						output += '"' + index + '"\t';

					}

					line += '"' + mappings[i][index] + '"\t';

				}

				if (i == 0) {
				
					output = output.slice(0, -1);

				}
				line = line.slice(0, -1);

				output += line;
			}

			document.getElementById('result').innerHTML  = output;
			document.getElementById('result').focus();
			document.getElementById('result').select();

		}

	});

	</script>

	<div>
		<label for="text">pr0p0ll-Ergebniss-JSON hier einf√ºgen und mit ENTER umwandeln:</label>
	</div>
	<div>
		<textarea style="width: 100%;" id="jsonData" name="jsonData" cols="50" rows="10"></textarea> 	
	</div>
	<div>
		<button onclick="process()">Click me</button>
	</div>
		<textarea style="width: 100%;" id="result" name="result" cols="50" rows="10"></textarea> 	
</body>

</html> 
