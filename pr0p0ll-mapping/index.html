<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>

<body>
	<script>

	function process() {

		var results = JSON.parse(document.getElementById('jsonData').value);
		var mappings = [];
		var questionIds = [];
		var answerKey = new RegExp('a\\d+'); // to identify answer properties

		for (let key in results){
			
			if(results.hasOwnProperty(key)){
					
				// let's parse a question
				if (key != 'info') {

					// first add this question's id to header as a new column
					// this makes it easier for you to do cross-references when 
					// analysing the data 
					// (e.g. how many people answered a1 in q1 also answered a2 in q3)
					<!-- mappings[].push(results[key]['id']); -->

					var question = results[key];
					if (!questionIds.includes(question.id)) {questionIds.push(question.id);}
					var mapping = [];
										
					for (let details in question) {

						if(question.hasOwnProperty(details)){

							// if this property matches you regex (starts with an a, ends with a number), it contains answer details
							if (answerKey.test(details)) {

								mapping['answerId'] = question[details]['id'];
								mapping['question'] = results[key].title;
								mapping[question.id] = question[details]['title'];
								mappings.push(mapping);
								mapping = [];

							}


						}

					}
				}
				<!-- console.log(`${key} : ${object[key]}`) -->
			
			}
		}

	
		// add all the columns and header array
		for (let key in mappings) {

			if(mappings.hasOwnProperty(key)){
				
				for (let i = 0; i <= questionIds.length - 1; i++) {
					
					if (mappings[key][questionIds[i]] == undefined) {
						
						mappings[key][questionIds[i]] = '';

					} 
					
				}

			}

		}

		// outpout
		var output = '"answerId"\t';

		for (var i = 0; i < mappings.length; i++) {
		
			var line = '\r\n';

			// this  is to force the foreing key to be in first column, makes it easier in Excel
			line += '"' + mappings[i]['answerId'] + '"\t';

			for (var index in mappings[i]) {

				if (index != 'answerId') {

					// header
					if (i == 0) {

						output += '"' + index + '"\t';

					}

					line += '"' + mappings[i][index] + '"\t';

				}

			}

			if (i == 0) {
			
				output = output.slice(0, -1);

			}
			line = line.slice(0, -1);

			output += line;
		}

		document.getElementById('result').innerHTML  = output;

	}

	</script>

	<div>
		<label for="text">pr0p0ll-Ergebniss-JSON hier einf√ºgen:</label>
	</div>
	<div>
		<textarea id="jsonData" name="jsonData" cols="50" rows="10"></textarea> 	
	</div>
	<div>
		<button onclick="process()">Click me</button>
	</div>
		<textarea id="result" name="result" cols="50" rows="10"></textarea> 	
</body>

</html> 
